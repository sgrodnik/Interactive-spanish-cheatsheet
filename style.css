:root {
    --color-bg: #f0f0f0;
    --color-card-bg: #ffffff;
    --color-text: #212529;
    --color-text-muted: #6c757d;
    --color-border: #ccc;
    --color-shadow: rgba(0,0,0,0.1);
    --color-highlight: #ffee58;
    --color-highlight-text: #000000;
    --color-header-border: #eee;
    --color-control-bg: #f8f9fa;
    --color-control-bg-hover: #e9ecef;
    --color-control-border: #adb5bd;
}

* {
    transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
}

body.theme-dark {
    --color-bg: #212529;
    --color-card-bg: #343a40;
    --color-text: #f8f9fa;
    --color-text-muted: #adb5bd;
    --color-border: #495057;
    --color-shadow: rgba(0,0,0,0.3);
    --color-highlight: #ffee58;
    --color-highlight-text: #000000;
    --color-header-border: #495057;
    --color-control-bg: #495057;
    --color-control-bg-hover: #6c757d;
    --color-control-border: #6c757d;
}

body.theme-sakura {
    --color-bg: #fce4ec;
    --color-card-bg: #ffffff;
    --color-text: #3E3E3E;
    --color-text-muted: #888;
    --color-border: #f8bbd0;
    --color-shadow: rgba(233, 30, 99, 0.1);
    --color-highlight: #f06292;
    --color-highlight-text: #ffffff;
    --color-header-border: #fce4ec;
    --color-control-bg: #fff;
    --color-control-bg-hover: #fce4ec;
    --color-control-border: #f8bbd0;
}

body.theme-mint {
    --color-bg: #e0f2f1;
    --color-card-bg: #ffffff;
    --color-text: #3E3E3E;
    --color-text-muted: #888;
    --color-border: #b2dfdb;
    --color-shadow: rgba(0, 150, 136, 0.1);
    --color-highlight: #4db6ac;
    --color-highlight-text: #ffffff;
    --color-header-border: #e0f2f1;
    --color-control-bg: #fff;
    --color-control-bg-hover: #e0f2f1;
    --color-control-border: #b2dfdb;
}

body.theme-lavender {
    --color-bg: #f3e5f5;
    --color-card-bg: #ffffff;
    --color-text: #3E3E3E;
    --color-text-muted: #888;
    --color-border: #e1bee7;
    --color-shadow: rgba(156, 39, 176, 0.1);
    --color-highlight: #ba68c8;
    --color-highlight-text: #ffffff;
    --color-header-border: #f3e5f5;
    --color-control-bg: #fff;
    --color-control-bg-hover: #f3e5f5;
    --color-control-border: #e1bee7;
}

body.theme-peach {
    --color-bg: #fff3e0;
    --color-card-bg: #ffffff;
    --color-text: #424242;
    --color-text-muted: #888;
    --color-border: #ffe0b2;
    --color-shadow: rgba(255, 152, 0, 0.1);
    --color-highlight: #ffb74d;
    --color-highlight-text: #000000;
    --color-header-border: #fff3e0;
    --color-control-bg: #fff;
    --color-control-bg-hover: #fff3e0;
    --color-control-border: #ffe0b2;
}

body.theme-rose {
    --color-bg: #ffebee;
    --color-card-bg: #ffffff;
    --color-text: #4b2c20;
    --color-text-muted: #8d6e63;
    --color-border: #ffcdd2;
    --color-shadow: rgba(239, 83, 80, 0.1);
    --color-highlight: #ef5350;
    --color-highlight-text: #ffffff;
    --color-header-border: #ffebee;
    --color-control-bg: #fff;
    --color-control-bg-hover: #ffebee;
    --color-control-border: #ffcdd2;
}

body.theme-bubblegum {
    --color-bg: #e3f2fd;
    --color-card-bg: #ffffff;
    --color-text: #1a237e;
    --color-text-muted: #5c6bc0;
    --color-border: #bbdefb;
    --color-shadow: rgba(66, 165, 245, 0.1);
    --color-highlight: #42a5f5;
    --color-highlight-text: #ffffff;
    --color-header-border: #e3f2fd;
    --color-control-bg: #fff;
    --color-control-bg-hover: #e3f2fd;
    --color-control-border: #bbdefb;
}

body.theme-lilac {
    --color-bg: #ede7f6;
    --color-card-bg: #ffffff;
    --color-text: #311b92;
    --color-text-muted: #7e57c2;
    --color-border: #d1c4e9;
    --color-shadow: rgba(103, 58, 183, 0.1);
    --color-highlight: #7e57c2;
    --color-highlight-text: #ffffff;
    --color-header-border: #ede7f6;
    --color-control-bg: #fff;
    --color-control-bg-hover: #ede7f6;
    --color-control-border: #d1c4e9;
}

body.theme-coral {
    --color-bg: #fff0e6;
    --color-card-bg: #ffffff;
    --color-text: #bf360c;
    --color-text-muted: #ff8a65;
    --color-border: #ffccbc;
    --color-shadow: rgba(255, 87, 34, 0.1);
    --color-highlight: #ff7043;
    --color-highlight-text: #ffffff;
    --color-header-border: #fff0e6;
    --color-control-bg: #fff;
    --color-control-bg-hover: #fff0e6;
    --color-control-border: #ffccbc;
}

body.theme-sky {
    --color-bg: #e1f5fe;
    --color-card-bg: #ffffff;
    --color-text: #01579b;
    --color-text-muted: #4fc3f7;
    --color-border: #b3e5fc;
    --color-shadow: rgba(3, 169, 244, 0.1);
    --color-highlight: #29b6f6;
    --color-highlight-text: #ffffff;
    --color-header-border: #e1f5fe;
    --color-control-bg: #fff;
    --color-control-bg-hover: #e1f5fe;
    --color-control-border: #b3e5fc;
}

body.theme-honey {
    --color-bg: #fffde7;
    --color-card-bg: #ffffff;
    --color-text: #f57f17;
    --color-text-muted: #ffee58;
    --color-border: #fff9c4;
    --color-shadow: rgba(255, 235, 59, 0.1);
    --color-highlight: #fdd835;
    --color-highlight-text: #000000;
    --color-header-border: #fffde7;
    --color-control-bg: #fff;
    --color-control-bg-hover: #fffde7;
    --color-control-border: #fff9c4;
}

body.theme-cotton-candy {
    --color-bg: #fde2e4;
    --color-card-bg: #ffffff;
    --color-text: #720026;
    --color-text-muted: #ff758f;
    --color-border: #fad2e1;
    --color-shadow: rgba(255, 117, 143, 0.1);
    --color-highlight: #ff8fa3;
    --color-highlight-text: #ffffff;
    --color-header-border: #fde2e4;
    --color-control-bg: #fff;
    --color-control-bg-hover: #fde2e4;
    --color-control-border: #fad2e1;
}

body.theme-strawberry {
    --color-bg: #ffe4e1;
    --color-card-bg: #ffffff;
    --color-text: #9b2226;
    --color-text-muted: #ee6c4d;
    --color-border: #ffcdd2;
    --color-shadow: rgba(208, 0, 0, 0.1);
    --color-highlight: #d00000;
    --color-highlight-text: #ffffff;
    --color-header-border: #ffe4e1;
    --color-control-bg: #fff;
    --color-control-bg-hover: #ffe4e1;
    --color-control-border: #ffcdd2;
}

body.theme-charcoal {
    --color-bg: #1a1a1a;
    --color-card-bg: #2c2c2c;
    --color-text: #e0e0e0;
    --color-text-muted: #a0a0a0;
    --color-border: #444;
    --color-shadow: rgba(0, 0, 0, 0.5);
    --color-highlight: #ff4500;
    --color-highlight-text: #ffffff;
    --color-header-border: #444;
    --color-control-bg: #333;
    --color-control-bg-hover: #444;
    --color-control-border: #555;
}

body.theme-blood {
    --color-bg: #1a0000;
    --color-card-bg: #330000;
    --color-text: #ff4d4d;
    --color-text-muted: #cc0000;
    --color-border: #660000;
    --color-shadow: rgba(102, 0, 0, 0.5);
    --color-highlight: #ff0000;
    --color-highlight-text: #ffffff;
    --color-header-border: #660000;
    --color-control-bg: #4d0000;
    --color-control-bg-hover: #660000;
    --color-control-border: #800000;
}

body.theme-toxic {
    --color-bg: #1b3300;
    --color-card-bg: #2e5900;
    --color-text: #99ff33;
    --color-text-muted: #66cc00;
    --color-border: #4d9900;
    --color-shadow: rgba(77, 153, 0, 0.5);
    --color-highlight: #7fff00;
    --color-highlight-text: #000000;
    --color-header-border: #4d9900;
    --color-control-bg: #3d8000;
    --color-control-bg-hover: #4d9900;
    --color-control-border: #5da600;
}

body.theme-abyss {
    --color-bg: #000c1a;
    --color-card-bg: #001f33;
    --color-text: #33adff;
    --color-text-muted: #007acc;
    --color-border: #004d80;
    --color-shadow: rgba(0, 77, 128, 0.5);
    --color-highlight: #008ae6;
    --color-highlight-text: #ffffff;
    --color-header-border: #004d80;
    --color-control-bg: #003d66;
    --color-control-bg-hover: #004d80;
    --color-control-border: #005d99;
}

body.theme-rust {
    --color-bg: #331a00;
    --color-card-bg: #592e00;
    --color-text: #ff9933;
    --color-text-muted: #cc6600;
    --color-border: #994d00;
    --color-shadow: rgba(153, 77, 0, 0.5);
    --color-highlight: #ff8c00;
    --color-highlight-text: #000000;
    --color-header-border: #994d00;
    --color-control-bg: #804000;
    --color-control-bg-hover: #994d00;
    --color-control-border: #a65300;
}

@media (prefers-color-scheme: dark) {
    body.theme-system {
        --color-bg: #212529;
        --color-card-bg: #343a40;
        --color-text: #f8f9fa;
        --color-text-muted: #adb5bd;
        --color-border: #495057;
        --color-shadow: rgba(0,0,0,0.3);
        --color-highlight: #ffee58;
        --color-highlight-text: #000000;
        --color-header-border: #495057;
        --color-control-bg: #495057;
        --color-control-bg-hover: #6c757d;
        --color-control-border: #6c757d;
    }
}

body {
    font-family: sans-serif;
    background-color: var(--color-bg);
    color: var(--color-text);
    margin: 0;
    padding: 0;
    height: 100vh;
    box-sizing: border-box;
    overflow: hidden;
    cursor: default !important;
}

body.is-loading #canvas {
    opacity: 0;
}

body.is-panning { cursor: grabbing !important; }

#canvas {
    position: relative;
    width: 100%;
    height: 100%;
    transform-origin: 0 0;
    opacity: 1;
    transition: opacity 0.4s ease-in-out; /* Corrected: transition is on the element itself */
}

#canvas.is-animating { 
    transition: transform 0.4s ease-out, opacity 0.4s ease-in-out;
}

.controls {
    position: fixed;
    top: 10px;
    right: 10px;
    z-index: 1000;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.control-group { display: flex; align-items: center; gap: 5px; }

.controls button, .controls select, #zoom-indicator {
    padding: 8px 12px;
    cursor: pointer !important;
    border: 1px solid var(--color-border);
    border-radius: 5px;
    background-color: var(--color-control-bg);
    color: var(--color-text);
    text-align: center;
    font-size: 0.9em;
    white-space: nowrap;
}

.controls button:hover, .controls select:hover, #zoom-indicator:hover {
    background-color: var(--color-control-bg-hover);
    border-color: var(--color-control-border);
}

.controls button:disabled { color: var(--color-text-muted); cursor: default !important; }

.tense-card {
    position: absolute;
    background-color: var(--color-card-bg);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    box-shadow: 0 4px 8px var(--color-shadow);
    padding: 15px;
    width: 250px;
    min-height: 200px;
    touch-action: none;
    box-sizing: border-box;
}

.tense-card.is-animating { transition: transform 0.4s ease-out; }
.tense-card h2 { cursor: grab !important; margin-top: 0; font-size: 1.2em; border-bottom: 1px solid var(--color-header-border); padding-bottom: 10px; margin-bottom: 10px; }
.tense-card.is-dragging { cursor: grabbing !important; }
.tense-card ul { padding-left: 20px; margin: 0; }
.tense-card table { width: 100%; border-collapse: collapse; font-size: 0.9em; }
.tense-card th, .tense-card td { border: 1px solid var(--color-border); padding: 4px; text-align: center; }

#orden { width: 450px; }
#orden table th, #orden table td { width: 25%; font-size: 0.8em; padding: 2px; }

.highlight {
    background-color: var(--color-highlight);
    color: var(--color-highlight-text);
    border-radius: 3px;
}

/* Default Layout */
#imperfecto { top: 20px; left: 20px; }
#indefinido { top: 20px; left: 290px; }
#perfecto { top: 20px; left: 560px; }
#presente { top: 20px; left: 830px; }
#futuro { top: 20px; left: 1100px; }
#imperativo { top: 350px; left: 20px; }
#condicional { top: 530px; left: 290px; }
#articulos-pronombres { top: 500px; left: 1100px; }

/* --- Custom Select --- */
.custom-select-wrapper {
    position: relative;
    width: 130px; /* Adjust width as needed */
}

.custom-select {
    position: relative;
}

.select-selected {
    background-color: var(--color-control-bg);
    color: var(--color-text);
    padding: 8px 12px;
    border: 1px solid var(--color-border);
    border-radius: 5px;
    cursor: pointer !important;
    user-select: none;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.select-selected:hover {
    background-color: var(--color-control-bg-hover);
    border-color: var(--color-control-border);
}

/* Arrow for the select box */
.select-selected::after {
    position: absolute;
    content: "";
    top: 50%;
    right: 15px;
    transform: translateY(-50%);
    width: 0;
    height: 0;
    border: 5px solid transparent;
    border-color: var(--color-text) transparent transparent transparent;
}

/* Point the arrow upwards when the select box is open (active) */
.select-selected.select-arrow-active::after {
    border-color: transparent transparent var(--color-text) transparent;
    top: 40%;
}

.select-items {
    position: absolute;
    background-color: var(--color-card-bg);
    top: 100%;
    left: 0;
    right: 0;
    z-index: 99;
    border: 1px solid var(--color-border);
    border-top: none;
    border-radius: 0 0 5px 5px;
    max-height: 600px;
    overflow-y: auto;
}

.select-hide {
    display: none;
}

.select-item {
    color: var(--color-text);
    padding: 8px 12px;
    cursor: pointer !important;
    user-select: none;
}

.select-item:hover, .same-as-selected {
    background-color: var(--color-control-bg-hover);
}
